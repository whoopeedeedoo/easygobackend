<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Easy Go!</title>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.css">
<script src="http://code.jquery.com/jquery-1.7.min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.js"></script>
<script src="/json.js"></script>
<script src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=true"></script>
<script src="js/alertify/lib/alertify.js"></script>

<!-- include the core styles -->
<link rel="stylesheet" href="js/alertify/themes/alertify.core.css" />
<link rel="stylesheet" href="js/alertify/themes/alertify.default.css" />
<style>
#page_1{ width: 100%; height:100%; padding: 0;background: #000000; }
#page_his{ width: 100%; height:100%; padding: 0;background: #000000; }
#map-page{ width: 100%; padding: 0;background: #000000; height:100%;}
#map-canvas {width: 100%; padding: 0;}

.img-responsive {
display: block;
max-width: 100%;
}

#lgo{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:66px;
	width:353px;
}

#lgo_go{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:383px;
	width:431px;
}

#lgo_his{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:95px;
	width:443px;
}

#lgo_set{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:96px;
	width:443px;
}

#popupBasic{
    width: 80%;
    left: 10%;
    right: 10%
}

</style>
</head> 
<body> 

<div data-role="page" id="page_1">

<div data-role="content">

<img class="img-responsive" src="logo.png" id="lgo">
<a href="#map-page" data-transition="slide"><img class="img-responsive" src="GO-button_03.png" id="lgo_go"></a>

<div id="kicker0">
</div>
<div id="kicker">
</div>


</div>	
</div>



<div data-role="page" id="map-page">
	<div data-role="content" style="height:33px;padding-top:0px;overflow:hidden;" id="hdr"> 
		  <div  class="ui-grid-b">
            <div class="ui-block-a" style="padding-top:0px;" >
			<div style="float:left;padding-top:0px;">
              <a href="#popupBasic" data-rel="popup" id="m1" data-position-to="window"><img src="P2_3.png" id="menu1" width="45" height="45"></a>
			  </div>
             
             <div style="float:right;padding-top:9px;padding-right:12px;">
			 <a href="#" id="rdmBtn" align="right"><img src="P2_4.png" id="rdmIcon" width="35" height="29"></a>
               </div>
             
            </div>
      		<div class="ui-block-b" >
        		<div id="selectList">
           <select id="wpse" name="wpsen" multiple="multiple" data-native-menu="false" data-theme="b" data-mini="true"><option>請先搜尋路點</option></select>
     			</div>
     		</div>
      		<div class="ui-block-c" id="selectList2">
            
            <div style="float:right;padding-top:1px;">
             
             <a href="#" id="r1"><img src="P2_2.png" id="go1" width="45" height="45"></a>
             </div>
             
             <div style="float:right;padding-top:10px;margin-right:3px;">
			 <a href="#" id="crossBTN" ><img src="cross.png" id="crossIMG" width="27" height="27" ></a>
               </div>
     		</div>
		</div >
        
        
        <div data-role="popup" id="popupBasic" class="ui-content" data-theme="b" data-overlay-theme="a">
			<a data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">關閉</a>
		
        起點：<br>
        <input type="text" id="start" data-mini="true">
        <a href="#" data-role="button" id="d1" data-inline="true" data-mini="true">現在位置</a>
        <a href="#" data-role="button" id="b1" data-inline="true" data-mini="true">確認起點</a>
        <br>
        終點：<br>
        <input type="text" id="end" data-mini="true">
        <a href="#" data-role="button" id="d2" data-inline="true" data-mini="true">現在位置</a>
        <a href="#" data-role="button" id="b2" data-inline="true" data-mini="true">確認終點</a><br><br>
        
      <div data-role="collapsible" data-mini="true" id="bigger">
   <h3>路點類型</h3>
    

           <fieldset data-role="controlgroup" id="fdt1"> 
            <input type="checkbox" name="category" id="category1" value="Local business" data-mini="true"/>  
            <label for="category1" data-theme="b">商務</label>  
  
            <input type="checkbox" name="category" id="category2" value="Restaurant/cafe" data-mini="true"/>  
            <label for="category2" data-theme="b">餐廳</label>  
            
            <input type="checkbox" name="category" id="category3" value="Hotel" data-mini="true"/>  
            <label for="category3" data-theme="b">旅館</label>  
            
            <input type="checkbox" name="category" id="category4" value="Travel/leisure" data-mini="true"/>  
            <label for="category4" data-theme="b">休閒</label>  
            
             <input type="checkbox" name="category" id="category5" value="School" data-mini="true"/>  
            <label for="category5" data-theme="b">學校</label>  
  
            <input type="checkbox" name="category" id="category6" value="Landmark" data-mini="true"/>  
            <label for="category6" data-theme="b">地標</label>  
            
            <input type="checkbox" name="category" id="category7" value="Tours/sightseeing" data-mini="true"/>  
            <label for="category7" data-theme="b">觀光</label>  
            
            <input type="checkbox" name="category" id="category8" value="Arts/entertainment/nightlife" data-mini="true"/>  
            <label for="category8" data-theme="b">娛樂</label>  
            
             <input type="checkbox" name="category" id="category9" value="Shopping/retail" data-mini="true"/>  
            <label for="category9" data-theme="b">購物</label>  
  
            <input type="checkbox" name="category" id="category10" value="Health/beauty" data-mini="true"/>  
            <label for="category10" data-theme="b">美容</label>  
            
            <input type="checkbox" name="category" id="category11" value="Food/grocery" data-mini="true"/>  
            <label for="category11" data-theme="b">食品</label>  
            
            <input type="checkbox" name="category" id="category12" value="Food/beverages" data-mini="true"/>  
            <label for="category12" data-theme="b">飲料</label>  
            
             <input type="checkbox" name="category" id="category13" value="Clothing" data-mini="true"/>  
            <label for="category13" data-theme="b">服飾</label>  
  
            <input type="checkbox" name="category" id="category14" value="Church/religious organization" data-mini="true"/>  
            <label for="category14" data-theme="b">宗教</label>  
            
            <input type="checkbox" name="category" id="category15" value="Museum/art gallery" data-mini="true"/>  
            <label for="category15" data-theme="b">博物館</label>  
            
            <input type="checkbox" name="category" id="category16" value="Sports venue" data-mini="true"/>  
            <label for="category16" data-theme="b">體育館</label>  
            
             <input type="checkbox" name="category" id="category17" value="Bar" data-mini="true"/>  
            <label for="category17" data-theme="b">酒吧</label>  
  
            <input type="checkbox" name="category" id="category18" value="Club" data-mini="true"/>  
            <label for="category18" data-theme="b">俱樂部</label>  
            
            <input type="checkbox" name="category" id="category19" value="Library" data-mini="true"/>  
            <label for="category19" data-theme="b">圖書館</label>  
            
            <input type="checkbox" name="category" id="category20" value="Retail and consumer merchandise" data-mini="true"/>  
            <label for="category20" data-theme="b">零售店</label>  
            
             <input type="checkbox" name="category" id="category21" value="Book store" data-mini="true"/>  
            <label for="category21" data-theme="b">書店</label>  
  
            <input type="checkbox" name="category" id="category22" value="Government organization" data-mini="true"/>  
            <label for="category22" data-theme="b">政府</label>  
            
            <input type="checkbox" name="category" id="category23" value="Movie theater" data-mini="true"/>  
            <label for="category23" data-theme="b">電影院</label>  
            
            <input type="checkbox" name="category" id="category24" value="Jewelry/watches" data-mini="true"/>  
            <label for="category24" data-theme="b">珠寶</label>  
            
             <input type="checkbox" name="category" id="category25" value="Hospital/clinic" data-mini="true"/>  
            <label for="category25" data-theme="b">院所</label>  
            

</div>
        
        
        
       
        
        
        路點關鍵字：<br>
        <input type="search" name="keyword" id="key" data-mini="true"><br>
        
        <a href="#" data-role="button" id="rwp" data-mini="true">搜尋路點</a><br>
		
		<a href="#" data-role="button" id="save_route" data-mini="true">收藏路線</a><br>
        
        <div id="selectList0">
            
        </div>
          
		</div>
        
        
	</div> 
        
    <div role="main" class="ui-content" id="map-canvas">
    </div>
    
    <div data-role="content" style="height:33px;padding-top:0px;overflow:hidden;" id="ftr"> 
        <div  class="ui-grid-b">
            <div class="ui-block-a">
               <div align="left" id="ftrl" style="padding-top:2px; color:white; text-shadow:1px  1px  1px  #dedede;" id="ftrl">
             
               </div>
            </div>
      		<div class="ui-block-b" >
               <div align="center" style="color:white; text-shadow:1px  1px  1px  #dedede;" id="ftrm">
                <a href="#" data-role="button" id="run" data-mini="true" data-theme="b" data-inline="true">START</a>
               </div>
     		</div>
      		<div class="ui-block-c">
               <div align="right" style="padding-top:12px; color:white; text-shadow:1px  1px  1px  #dedede;" id="ftrr">

               </div>
     		</div>
		</div >
    
    
    
    
    </div>
</div>


<div data-role="page" id="page_his">

	<div data-role="content" id ="plain">

   
   
   
   
   
   
   


	</div>	
</div>






<script>
var geocoder;
var map;
var directionsService;
var directionsDisplay=null;
var marker_s=null;
var marker_e=null;
var sp=null;
var ep=null;
var timeoutId = 0;
var timeoutId2 = 0;
var tctr=0;
var hh;
var mm;
var ss;
var dh;
var dm;
var ds;
var ttt;
var s_flag=0;
var marker_rt=null;
var rngMax;
var localLat=[];
var localLng=[];
var addr_s;
var addr_e;
var markerArray=[];
var markerArray0=[];
var flagFinded;
var stepDisplay;
var page_map_sve_flg=0;
var uid=null;
var autoLatLng=[];
var autoName=[];
var resp=null;

$( document ).on( "pageshow", "#page_his", function() {

 
 
 $("#plain").html('');
 resp=null;
 
 $.ajax({
                url: '/isAuthenticated',
                type:"GET",
                dataType:'json',

                success: function(msg){
				
				if(msg.message=="no")
				{
				
				alertify.alert("請先登入");
				
				}else if(msg.message=="yes")
				{
				
				                $.ajax({
                						url: '/history/find/user/'+msg.uid,
                						type:"GET",
                						dataType:'json',

                						success: function(msg){
				
				                           
										   
										   for(i=0;i<msg.length;i++)
										   {
										      
$("#plain").append('<button id="mgg'+i+'" data-theme="b" value="'+i+'">第'+i+'路線</button>');
						 
										   
										   }
										   
										  $("#plain").trigger('create');
										  
										  for(i=0;i<msg.length;i++)
										  {
											
											$("#mgg"+i).on( "click", function() {
										     
											var ttt=$(this).val();
											
											resp=msg[ttt];
										 
											 $.mobile.changePage("#map-page"); 
										  
										  	});
										  } 
				
										},

                 						error:function(){ 
                    					alertify.error("失敗")
                 						}
               					}); 
    
				
				}
				
				
				},

                 error:function(){ 
                    alertify.error("失敗")
                 }
               }); 

});








$( document ).on( "pageshow", "#page_1", function() {

 $.ajax({
                url: '/isAuthenticated',
                type:"GET",
                dataType:'json',

                success: function(msg){
				
				if(msg.message=="no")
				{
				
				
				$("#kicker").html('<a href="/login" id="loginOut" data-ajax="false"><img class="img-responsive" src="log_in.png" id="lgo_set"></a>');
				
				$("#kicker0").html('<img class="img-responsive" src="history_log_03.png" id="lgo_his">');
				
				
				}else if(msg.message=="yes")
				{
				
				
				$("#kicker").html('<a href="/logout" id="loginOut" data-ajax="false"><img class="img-responsive" src="log_out.png" id="lgo_set"></a>');
				
				$("#kicker0").html('<a href="#page_his" id="hisA"><img class="img-responsive" src="history_log_03.png" id="lgo_his"></a>');
				
				}
				
				p1_resize();
				
				},

                 error:function(){ 
                    alertify.error("失敗")
                 }
               }); 

});

$( document ).on( "pageshow", "#map-page", function() {

hisRT();



$.ajax({
                url: '/isAuthenticated',
                type:"GET",
                dataType:'json',

                success: function(msg){
				
				if(msg.message=="no")
				{
				
				
$("#save_route").off();
autoLatLng=[];
autoName=[];
resp=null;
uid=null;
$("#save_route").addClass('ui-disabled');

				page_map_sve_flg=0;
				
				}else if(msg.message=="yes")
				{
				
				page_map_sve_flg=1;
				uid=msg.uid;
				
			
				}
			
				
				},

                 error:function(){ 
                    alertify.error("失敗")
                 }
               }); 


});




$(window).resize(function() {
  p1_resize();
  var txe=window.innerHeight-98;
  $("#map-canvas").css({"height":txe+"px"});

});



$( document ).on( "pageinit", "#map-page", function() {
	
	var txe=window.innerHeight-98;
	$("#map-canvas").css({"height":txe+"px"});

	$("#wpse").selectmenu('disable');
	$("#run").addClass('ui-disabled');
	$("#save_route").addClass('ui-disabled');
	
	
    var defaultLatLng = new google.maps.LatLng(25.047968, 121.517081); 
	geocoder = new google.maps.Geocoder();
	directionsService = new google.maps.DirectionsService();
    
    drawMap(defaultLatLng); 
	stepDisplay = new google.maps.InfoWindow();
	
	
$("#bigger").on( "collapsibleexpand",function() {
	
	var offst = $("#popupBasic").offset();
	
	$("#popupBasic-screen").height(offst.top+ $("#popupBasic").outerHeight());
	
	
});

$("#bigger").on( "collapsiblecollapse",function() {
	
	
	$("#popupBasic-screen").height(window.innerHeight);
	
	
});


$("#popupBasic").on( "popupafteropen",function() {
	
	if($("#popupBasic").outerHeight()>window.innerHeight){
	
	var offst = $("#popupBasic").offset();
	
	$("#popupBasic-screen").height(offst.top+ $("#popupBasic").outerHeight());
	
	}
	
	//$('ul.load_details').css({visibility,"visible"});
$("#map-canvas").css({visibility:"hidden"});
$("#hdr").css({visibility:"hidden"});
$("#ftr").css({visibility:"hidden"});
	
	
});

$("#popupBasic").on( "popupafterclose",function() {
	
$("#map-canvas").css({visibility:"visible"});
$("#hdr").css({visibility:"visible"});
$("#ftr").css({visibility:"visible"});
	
	
});



$("#d1").on( "click",function() {
    if ( navigator.geolocation ) {
        function success(pos) {
			 var latlng = new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
			 geocoder.geocode({'latLng': latlng}, function(results, status) {
     			 if (status == google.maps.GeocoderStatus.OK) {
        			if (results[0]) {
				     $("#start").val(results[0].formatted_address);
					}
                 } else {
                    alertify.error("轉換失敗")
                 }
             });
        }
        function fail(error) {
            alertify.error("定位失敗")
        }
        // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
        navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
    } else {
        alertify.error("瀏覽器不支援或未開啟定位功能")
    }
});
		
$("#d2").on( "click",function() {
	  if ( navigator.geolocation ) {
        function success(pos) {
			var latlng = new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
			 geocoder.geocode({'latLng': latlng}, function(results, status) {
     			 if (status == google.maps.GeocoderStatus.OK) {
        			if (results[0]) {
				     $("#end").val(results[0].formatted_address);
					}
                 } else {
                    alertify.error("轉換失敗")
                 }
             });
        }
        function fail(error) {
            alertify.error("定位失敗")
        }
        // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
        navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
    } else {
        alertify.error("瀏覽器不支援或未開啟定位功能")
    }          
});
		

		

		
setRWP();
setB1();
setB2();


});

function drawMap(latlng) {
        var myOptions = {
            zoom: 15,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
       map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
    }
	

function time() {
			 tctr+=1;
			 ttt=tctr; 
		     hh=parseInt(ttt/3600);
			 ttt-=(hh*3600);
			 mm=parseInt(ttt/60);
			 ttt-=(mm*60);
			 ss=ttt;
			 
			 if(hh<10)
			 {
				 dh="0"+hh+":";
			 }else
			 {
				 dh=hh+":";
			 }
			 
			 if(mm<10)
			 {
				 dm="0"+mm+":";
			 }else
			 {
				 dm=mm+":";
			 }
			 
			  if(ss<10)
			 {
				 ds="0"+ss+"&nbsp;";
			 }else
			 {
				 ds=ss+"&nbsp;";
			 }
			 
			 
			 $("#ftrr").html(dh+dm+ds);
}

function realTime()
{
	 
	 if ( navigator.geolocation ) {
        function success(pos) {
			 var rt= new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
			 map.setCenter(rt);
			 if(marker_rt!=null)
			{
				marker_rt.setMap(null);
				google.maps.event.trigger(map, "resize");
			}
				marker_rt = new google.maps.Marker({
            			map: map,
            			position: rt
        		});
			
			
        }
        function fail(error) {
            
        }
        // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
        navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 0, enableHighAccuracy:true, timeout: 6000});
    } else {
        alertify.error("瀏覽器不支援或未開啟定位功能")
    }
	


}

function rng(minN,maxN)
{

  var nb = Math.floor(Math.random() * (maxN - minN + 1)) + minN;  
  return nb;
}

 function attachInstructionText(markerr, text) {
    google.maps.event.addListener(markerr, 'click', function() {
      // Open an info window when the marker is clicked on,
      // containing the text of the step.
      stepDisplay.setContent(text);
      stepDisplay.open(map, markerr);
    });
  }
  
function sendd(cgoy,ky,li,tk,rad,center,goyCtr,upL,allFlag)
{
	
	 var dts;
	 
	 if(allFlag==true){
	 var tree="";
     dts={ coordinates: center, radius: rad, limit:li ,token:tk,keyword:ky,category:tree};						
								  							 
	 }else
	 {
		 dts={ coordinates: center, radius: rad, limit:li ,token:tk,keyword:ky,category:cgoy[goyCtr]};		
	 }
			
			
			$.ajax(
				 						{   url: 'fbapi/fbcheckinStep',
							    			//async: false,
				     						type: 'POST',
											data:dts,
	  				 						dataType: "json",
                     						success: function(Jdata2) { 
											
											var rst=Jdata2.message;
											var ctr=Jdata2.total;
											var localName=[];
											
											var check=[];
											var basic;
											var funLat=[];
											var funLng=[];
											
											
											for(i=0;i<ctr;i++){
							                   
												check[i]=Jdata2.result[i].checkins;
												localName[i]=Jdata2.result[i].name;
												localName[i]=localName[i].replace(/\\/g,"%");
												localName[i]=decodeURI(localName[i]);	
												funLat[i]=Jdata2.result[i].latitude;
											    funLng[i]=Jdata2.result[i].longitude;
											}
											
											basic=flagFinded;
											flagFinded+=ctr;
											li-=ctr;
											
											
											for(c=0;c<ctr;c++){
							                   
												localLat[basic]=funLat[c];
												localLng[basic]=funLng[c];
												basic++;
											}
											
											 
								 for(i=0;i<ctr;i++){
							                    $("#wpse").append('<option value="'+funLat[i]+','+funLng[i]+'">'+localName[i]+'#人氣度:'+check[i]+'</option>');												
											  }
											
											
											
											
											upL--;
											
											if((upL!=0)&&(li>0))
											{
												goyCtr++;
												sendd(cgoy,ky,li,tk,rad,center,goyCtr,upL,allFlag);
											}else
											{
												rngMax=flagFinded;
											
											if(flagFinded==0){
						
											  $("#selectList0").html('沒有找到任何路點');
											  alertify.log('沒有找到任何路點');
											  $("#wpse").html('<option>請先搜尋路點</option>');
											  $("#wpse").selectmenu('refresh');
											  setRWP();
											  setB1();
											  setB2(F);
											

											}else if(flagFinded>0)
											{
											  $("#selectList0").html('找到'+flagFinded+'個路點');

										alertify.success('找到'+flagFinded+'個路點');

											  $("#wpse").prepend('<option>請選擇最多六個路點</option>');
											  
											  $("#wpse").selectmenu('refresh');
											  
											  $("#wpse").selectmenu('enable');
											  
											 	
												
												
												
												
												$("#wpse").on( "change",function () {
													$(this).selectmenu('refresh');
                                                var st=$(this).find("option:selected");
								                if (st.length>5) {
								                 $(this).selectmenu('close');
								                 $(this).selectmenu('disable');
                                                 } 
                                                });	
												
												setRPmarkers();					  
										  
	
	$("#rdmBtn").on( "click",function() {
		var crr;
		var haha=[];
		var tyu;
		var flg;
		var yoyo=[];
		
		if(rngMax>0)
		{
			if(rngMax<5)
			{
				crr=rng(1,rngMax);
			}else
			{
				crr=rng(1,5);
			}
			
			var hgh=0;
			
			while(hgh<crr)
			{
				tyu=rng(1,rngMax);
				flg=0;
				for(j=0;j<haha.length;j++)
				{
				   if(tyu==haha[j])
				   {
					   flg=1;   
				   }	
				}
				if(flg!=1)
				{
				  
				  haha.push(tyu);
				  hgh++;
				}
			}
			
			for(j=0;j<haha.length;j++)
			{
				   yoyo.push(localLat[haha[j]-1]+','+localLng[haha[j]-1]);
		    }
			
			$('#wpse').val(yoyo).selectmenu('refresh',true);
			
			$("#wpse").selectmenu('enable');
			
		}
		
		
		});										  



$("#r1").on( "click",function() {
      
	   var wayPnts=$("#wpse").val()||[];
	   var wptSend=[];
	   var request;
	   
	   if(wayPnts.length==0){
	    request = {
                origin: $("#start").val(),
                destination: $("#end").val(),
				optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
        };
		
	   }else if(wayPnts.length>0){
		   for(i=0;i<wayPnts.length;i++)
		   {
			   var xx;
			   var aa;
			   var bb;
			   var cc;
			   
			   xx=wayPnts[i].split(",");
			   aa=xx[0];
			   bb=xx[1];
			   
			   cc=new google.maps.LatLng(aa,bb); 
			   
			   wptSend.push({
          		location:cc,
          		stopover:true});
		   }
		   
		    request = {
                origin: $("#start").val(),
                destination: $("#end").val(),
				waypoints: wptSend,
				optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
            };
		   
		}
		
		directionsService.route(request, function(response, status) {
                //規畫路徑回傳結果
                if (status == google.maps.DirectionsStatus.OK) {
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						
						
	                    
    					
						var rendererOptions = {
  							map: map,
  							suppressMarkers : true
						}
						
						directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
						
						directionsDisplay.setMap(map);
						
                        directionsDisplay.setDirections(response);
						
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
						
$("#save_route").off();
autoLatLng=[];
autoName=[];
resp=null;
$("#save_route").addClass('ui-disabled');
						
						invibleRPmarkers();
						
				if(page_map_sve_flg==1)
				{
				
				    setSave();
				    $("#save_route").removeClass('ui-disabled');
				}
						
						
						
						var landNArray=[];
						var landLGG=[];
						 var icon_s="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=star|FF0000|000000";
						  var icon_e="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=flag|FF0000|000000";
						  var icon_f="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=glyphish_walk|6aad32|000000";
						 
						 var marker_temp_s = new google.maps.Marker({
                            position: sp, 
                            map: map,
                            icon: icon_s
                         });
						 
						 attachInstructionText(marker_temp_s, addr_s);
						 
						var marker_temp_e = new google.maps.Marker({
                            position: ep, 
                            map: map,
                            icon: icon_e
                         });
						
						attachInstructionText(marker_temp_e, addr_e);
						
						markerArray.push(marker_temp_s);
						markerArray.push(marker_temp_e);
						
						 $("#wpse option:selected").each(function(){
    							landNArray.push($(this).text());
								landLGG.push($(this).val());
								
								autoLatLng.push($(this).val());
								var www=$(this).text().split("#");
			                    autoName.push(www[0]);
  						 });
						 
						 for(k=0;k<landNArray.length;k++)
						 {
							var xxx=landLGG[k].split(",");
			                var aaa=xxx[0];
			                var bbb=xxx[1];
			   
			                var ccc=new google.maps.LatLng(aaa,bbb); 
							
							
							 var marker_temp= new google.maps.Marker({
                           		 position: ccc, 
                            	 map: map,
                            	 icon: icon_f
                         	});
							 
							 attachInstructionText(marker_temp,landNArray[k]);
						
						     markerArray.push(marker_temp);
							 
						 }
						
						
						
						
						
						 var totalDistance = 0;
   						 var totalDuration = 0;
                         var legs = response.routes[0].legs;
                         for(var i=0; i<legs.length; ++i) {
                             totalDistance += legs[i].distance.value;
                             totalDuration += legs[i].duration.value;
                         }
						 
						 totalDistance/=1000;
						 totalDistance=parseInt(totalDistance);
						 totalDuration/=60;
						 totalDuration=parseInt(totalDuration);
						 
                         $('#ftrl').html(totalDistance+"公里<br>"+totalDuration+"分鐘");
						
						$("#run").removeClass('ui-disabled');
		 				$("#ftrr").html("00:00:00&nbsp;"); 
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						
		
		                $("#run").on( "click",function() {
		    
                            if(s_flag==0){
			 
			                timeoutId = setInterval(function(){time();},1000);
			                timeoutId2 = setInterval(function(){realTime();},6500);
			                $("#run").html('STOP');
			 
			                 s_flag=1;
			 
			                }else if(s_flag==1){
			 
			                   clearInterval(timeoutId);
			                   clearInterval(timeoutId2);
			                   if(marker_rt!=null)
							   {
									marker_rt.setMap(null);
									google.maps.event.trigger(map, "resize");
								}
			                   $("#run").html('START');
			 
			                   s_flag=0;
			                }
		 
		 
		                 });
		
						
						
						
                }
        });
		
		
		
		
});
											  
setRWP();			
setB1();
setB2();							  


	$("#crossBTN").on( "click",function() {
							
							
							$("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
											
							
							showRPmarkers();
							
							var blanker=[];
							
							 $('#wpse').val(blanker).selectmenu('refresh',true);
	                         $("#wpse").selectmenu('enable');	
                             
                             $("#save_route").off();
							 autoLatLng=[];
                             autoName=[];
                             resp=null;
                             $("#save_route").addClass('ui-disabled');
							
						});
                        

}
												
												
												
											}

											},
											error: function(xhr, ajaxOptions, thrownError) {
									           setRWP();			
											   setB1();
                                               setB2();	
											   alert.error(thrownError);
											   
                     			            }
									     });											 
	

}



function p1_resize()
{
var logo_w=353;
var logo_h=66;
var go_w=431;
var go_h=383;
var his_w=443;
var his_h=95;
var set_w=443;
var set_h=96;
var txe0=window.innerHeight;


var sum=logo_h+go_h+his_h+go_h+160;
var per=txe0/sum;
logo_w=logo_w*per;
logo_h=logo_h*per;
go_w=go_w*per;
go_h=go_h*per;
his_w=his_w*per;
his_h=his_h*per;
set_w=set_w*per;
set_h=set_h*per;



$("#lgo").css({"width":logo_w+"px"});
$("#lgo").css({"height":logo_h+"px"});
$("#lgo_go").css({"width":go_w+"px"});
$("#lgo_go").css({"height":go_h+"px"});
$("#lgo_his").css({"width":his_w+"px"});
$("#lgo_his").css({"height":his_h+"px"});
$("#lgo_set").css({"width":set_w+"px"});
$("#lgo_set").css({"height":set_h+"px"});

	
}

function setRPmarkers()
{
	var landNArray0=[];
	var landLGG0=[];
	var icon_w="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=glyphish_compass|6aad32|000000"
	
	
	$("#wpse option[value]").each(function(){
    							landNArray0.push($(this).text());
								landLGG0.push($(this).val());
  						 });
						 
						
						 
						 
						 for(k=0;k<landNArray0.length;k++)
						 {
							
							
							var xxx0=landLGG0[k].split(",");
			                var aaa0=xxx0[0];
			                var bbb0=xxx0[1];
			   
			                
							var ccc0=new google.maps.LatLng(aaa0,bbb0); 
							
							
							 var marker_temp0= new google.maps.Marker({
                           		 position: ccc0, 
                            	 map: map,
								 icon: icon_w
                         	});
							 
							 
							 
							 var hml='<p>'+landNArray0[k]+'</p><button onclick="myFunc(\''+landLGG0[k]+'\')">選擇</button>';
							 	
							 attachInstructionText(marker_temp0,hml);
						
						    
							 markerArray0.push(marker_temp0);
							 
							 
							 
						 }
						 
						 
						 
	
	
	
}


function invibleRPmarkers()
{
	if(marker_s!=null)
						{
							marker_s.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						
						if(marker_e!=null)
						{
							marker_e.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						
	
		for(i=0;i<markerArray0.length;i++)
		{
			markerArray0[i].setMap(null);
			google.maps.event.trigger(map,"resize");
			
		}	
	
}

function showRPmarkers()
{
	marker_s.setMap(map);
	google.maps.event.trigger(map,"resize");
		
	marker_e.setMap(map);
	google.maps.event.trigger(map,"resize");
		
		
		for(i=0;i<markerArray0.length;i++)
		{
			markerArray0[i].setMap(map);
			google.maps.event.trigger(map,"resize");
		}	
}

function killRPmarkers()
{
		for(i=0;i<markerArray0.length;i++)
		{
			markerArray0[i].setMap(null);
			google.maps.event.trigger(map,"resize");
			
			
		}	
		markerArray0=[];	
	
}


function myFunc(bbbd)
{
   
   
   var kkg=$('#wpse').val()||[];
   var flagGG=0;
								
   for(op=0;op<kkg.length;op++)
   {
	   if(kkg[op]==bbbd)
	   {
		  flagGG=1;
		  alertify.error("重複選擇囉")	;
	   }
   }
   
   if((flagGG==0)&&(kkg.length<6)){
   kkg.push(bbbd);
   alertify.success("已選擇")	;

   $('#wpse').val(kkg).selectmenu('refresh',true);
   if(kkg.length==6)
   {
	   $("#wpse").selectmenu('disable');
	   alertify.alert("已達上限")	;
	}	
   }
   else if(kkg.length==6){
   		alertify.error("已達上限")	;
   }
   setTimeout(function(){
   		stepDisplay.close();
   },100)
   
							
}

function setRWP()
{
	$("#rwp").on( "click",function() {
	
	        if((sp!=null)&&(ep!=null)){
                       
					   
					   $("#rwp").off();
					    $("#b1").off();
						 $("#b2").off();
					   
					   
					   $.ajax(
				 			{   
                                //url: '/proxy.php',
							    //async: false,
				     			//type: 'GET',
                                url: "/fbapi/token",
                                type: "POST",
	  				 			dataType: "json",
                     
                     			success: function(Jdata) { 
								
								 	var center0;
									var rad0;
									var catArray=[];
									
									if((ep.lat()==sp.lat())&&(ep.lng()==sp.lng())){
									 
								    center0=sp.lat()+','+sp.lng(); 
								    rad0=1;
								 
								    }else{
									
									   var lt=(sp.lat()+ep.lat())/2;
									   var lg=(sp.lng()+ep.lng())/2
									 
									   var step3=google.maps.geometry.spherical.computeDistanceBetween(sp,ep)/1000/2;
									   if(step3<1){step3=1;}
								    
								       center0=lt+','+lg; 
								       rad0=step3;
								    }
									
									
									$("input:checkbox[name=category]:checked").each(function(){
    							             catArray.push($(this).val());
  						            });
									
									var khyu=$("#key").val();
									var tykk=Jdata.result.token;
									
									flagFinded=0;
									
									localLat=[];
									localLng=[];
									
									
									
									$("#selectList0").html('載入中請耐心等候'); 
											$("#wpse").off();
        									$("#wpse").html('');
											$("#crossBTN").off();
											$("#wpse").selectmenu('refresh');
											$("#wpse").selectmenu('disable');
											$("#r1").off();
											$("#rdmBtn").off();
											$("#run").addClass('ui-disabled');
		 				                    $("#ftrr").html(""); 
						                    $('#ftrl').html("");
		 				                    tctr=0;
		                                    s_flag=0;
						                    clearInterval(timeoutId);
			                                clearInterval(timeoutId2);
			                                if(marker_rt!=null)
					                       {
							                   marker_rt.setMap(null);
						                      google.maps.event.trigger(map, "resize");
						                   }
			                               $("#run").html('START');
						
						                   $("#run").off();
										   
										   if(directionsDisplay!=null)
											{
													directionsDisplay.setMap(null);
													google.maps.event.trigger(map,"resize");
											}
											google.maps.event.clearListeners(map, "click");
											for(p=0;p<markerArray.length;p++)
											{
													markerArray[p].setMap(null);
													google.maps.event.trigger(map, "resize");
											}
											markerArray=[];

									
$("#save_route").off();
autoLatLng=[];
autoName=[];
resp=null;
$("#save_route").addClass('ui-disabled');
									
									        killRPmarkers();
									
									
									
									
									if(catArray.length==0)
									{
										sendd(catArray,khyu,20,tykk,rad0,center0,0,1,true)
										
									}else if(catArray.length>0)
									{	
										sendd(catArray,khyu,20,tykk,rad0,center0,0,catArray.length,false)
									}
												
									
                    			 },
                     			error: function(xhr, ajaxOptions, thrownError) {
									alertify.error(thrownError);
                     			}
                 		 });
			}

});
	
	
}

function setB1()
{
	$("#b1").on( "click",function() {
   var address = $("#start").val();
   addr_s=address;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        if(marker_s!=null)
		{
			marker_s.setMap(null);
			google.maps.event.trigger(map, "resize");
		}
		marker_s = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
		sp=results[0].geometry.location;
		
		$("#selectList0").html('');
		$("#wpse").off();
		$("#crossBTN").off();
		
        $("#wpse").html('<option>請先搜尋路點</option>');
		$("#wpse").selectmenu('refresh');
		$("#wpse").selectmenu('disable');
		$("#r1").off();
		$("#rdmBtn").off();
		
						$("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];

$("#save_route").off();
autoLatLng=[];
autoName=[];
resp=null;
$("#save_route").addClass('ui-disabled');				
						
						killRPmarkers();
						alertify.success('已確認起點');
		
		
      } else {
        alertify.error("定位失敗");
      }
    });
});
}

function setB2()
{
	$("#b2").on( "click",function() {
   var address = $("#end").val();
   addr_e=address;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
		if(marker_e!=null)
		{
			marker_e.setMap(null);
			google.maps.event.trigger(map,"resize");
		}
        marker_e = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
		ep=results[0].geometry.location;
		
		$("#selectList0").html('');
		$("#wpse").off();
		$("#crossBTN").off();
        $("#wpse").html('<option>請先搜尋路點</option>');
		$("#wpse").selectmenu('refresh');
		$("#wpse").selectmenu('disable');
		$("#r1").off();
		$("#rdmBtn").off();
		
		                $("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
						
$("#save_route").off();
autoLatLng=[];
autoName=[];
resp=null;
$("#save_route").addClass('ui-disabled');

						killRPmarkers();
						alertify.success('已確認終點');
		
		
      } else {
        alertify.error("定位失敗");
      }
    });
});
}


function setSave()
{


$("#save_route").on( "click",function() {

var dts00;
var arry00=[];

$("#save_route").off();

$("#selectList0").html('收藏中請稍候');

var spt=sp.lat()+','+sp.lng();
var ept=ep.lat()+','+ep.lng();

var spSave={"land":spt,"name":addr_s};
var epSave={"land":ept,"name":addr_e};
var spSave_j = $.toJSON(spSave);
var epSave_j = $.toJSON(epSave);

arry00.push(spSave_j);

for(i=0;i<autoLatLng.length;i++)
{
  var tempA={"land":autoLatLng[i],"name":autoName[i]};
  var tempA_j = $.toJSON(tempA);
  arry00.push(tempA_j);
}

arry00.push(epSave_j);

dts00={ path: arry00, userid: uid};	

 $.ajax({
                url: '/history/create',
                type:'POST',
				data:dts00,
                dataType:'json',
				

                success: function(msg){
				$("#selectList0").html('收藏完成');
				alertify.success("收藏完成");
				
				autoLatLng=[];
				autoName=[];
				$("#save_route").addClass('ui-disabled');
				
				},

                 error:function(){ 
                    alertify.error("送出失敗");
					setSave();
                 }
               }); 

});


}


function hisRT()
{
  
  if(resp!=null){
  
    if(marker_s!=null)
	{
			marker_s.setMap(null);
			google.maps.event.trigger(map, "resize");
	}
	marker_s=null;
    sp=null;
	$("#start").val('');
	
	
   if(marker_e!=null)
	{
			marker_e.setMap(null);
			google.maps.event.trigger(map, "resize");
	}
	marker_e=null;
    ep=null;
	$("#end").val('');
  
  $("#selectList0").html('');
		$("#wpse").off();
		$("#crossBTN").off();
		
        $("#wpse").html('<option>請先搜尋路點</option>');
		$("#wpse").selectmenu('refresh');
		$("#wpse").selectmenu('disable');
		$("#r1").off();
		$("#rdmBtn").off();
		
						$("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];

$("#save_route").off();
autoLatLng=[];
autoName=[];

$("#save_route").addClass('ui-disabled');				
						
						killRPmarkers();
						
						
var wptSend00=[];

var request00;

var pth='['+resp.path+']';

var pth_j=jQuery.parseJSON(pth);

var lntt=pth_j.length-1;

       
	   if(pth_j.length<=2){
	    request00 = {
                origin: pth_j[0].name,
                destination: pth_j[lntt].name,
				optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
        };
		
	   }else{
		   for(i=1;i<lntt;i++)
		   {
			   var xx01;
			   var aa01;
			   var bb01;
			   var cc01;
			   
			   xx01=pth_j[i].land.split(",");
			   aa01=xx01[0];
			   bb01=xx01[1];
			   
			   cc01=new google.maps.LatLng(aa01,bb01); 
			   
			   wptSend00.push({
          		location:cc01,
          		stopover:true});
		   }
		   
		    request00 = {
                origin: pth_j[0].name,
                destination: pth_j[lntt].name,
				waypoints: wptSend00,
				optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
            };
		   
		}	
						
				directionsService.route(request00, function(response0, status) {
                //規畫路徑回傳結果
                if (status == google.maps.DirectionsStatus.OK) {
    					
						
						
						
						var rendererOptions = {
  							map: map,
  							suppressMarkers : true
						}
						
						directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
						
						directionsDisplay.setMap(map);
						
                        directionsDisplay.setDirections(response0);		
						
						
						 var icon_s0="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=star|FF0000|000000";
			     var icon_e0="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=flag|FF0000|000000";
				 var icon_f0="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=glyphish_walk|6aad32|000000";
						 
				 
				 
				 var xx02;
			     var aa02;
			     var bb02;
			     var cc02;
			   
			   xx02=pth_j[0].land.split(",");
			   aa02=xx02[0];
			   bb02=xx02[1];
			   
			   cc02=new google.maps.LatLng(aa02,bb02); 
			   
			   var xx03;
			     var aa03;
			     var bb03;
			     var cc03;
			   
			   xx03=pth_j[lntt].land.split(",");
			   aa03=xx03[0];
			   bb03=xx03[1];
			   
			   cc03=new google.maps.LatLng(aa03,bb03); 
				 
						 var marker_temp_s0 = new google.maps.Marker({
                            position: cc02, 
                            map: map,
                            icon: icon_s0
                         });
						 
						 attachInstructionText(marker_temp_s0, pth_j[0].name);
						 
						var marker_temp_e0 = new google.maps.Marker({
                            position: cc03, 
                            map: map,
                            icon: icon_e0
                         });
						
						attachInstructionText(marker_temp_e0, pth_j[lntt].name);
						
						markerArray.push(marker_temp_s0);
						markerArray.push(marker_temp_e0);
						
						
						for(i=1;i<lntt;i++)
		   				{
			   				var xx04;
			   				var aa04;
			   				var bb04;
			   				var cc04;
			   
			   				xx04=pth_j[i].land.split(",");
			   				aa04=xx04[0];
			   				bb04=xx04[1];
			   
			   				cc04=new google.maps.LatLng(aa04,bb04); 
							
							var marker_temp0= new google.maps.Marker({
                           		 position: cc04, 
                            	 map: map,
                            	 icon: icon_f0
                         	});
							 
							 attachInstructionText(marker_temp0,pth_j[i].name);
						
						     markerArray.push(marker_temp0);

		   				}
						
						
						
						 var totalDistance0 = 0;
   						 var totalDuration0 = 0;
                         var legs0 = response0.routes[0].legs;
                         for(var i=0; i<legs0.length;i++) {
                             totalDistance0 += legs0[i].distance.value;
                             totalDuration0 += legs0[i].duration.value;
                         }
						 
						 totalDistance0/=1000;
						 totalDistance0=parseInt(totalDistance0);
						 totalDuration0/=60;
						 totalDuration0=parseInt(totalDuration0);
						 
                         $('#ftrl').html(totalDistance0+"公里<br>"+totalDuration0+"分鐘");
						
						$("#run").removeClass('ui-disabled');
		 				$("#ftrr").html("00:00:00&nbsp;"); 
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            
			            $("#run").html('START');
						
						$("#run").off();
						
		
		                $("#run").on( "click",function() {
		    
                            if(s_flag==0){
			 
			                timeoutId = setInterval(function(){time();},1000);
			                timeoutId2 = setInterval(function(){realTime();},6500);
			                $("#run").html('STOP');
			 
			                 s_flag=1;
			 
			                }else if(s_flag==1){
			 
			                   clearInterval(timeoutId);
			                   clearInterval(timeoutId2);
			                   if(marker_rt!=null)
							   {
									marker_rt.setMap(null);
									google.maps.event.trigger(map, "resize");
								}
			                   $("#run").html('START');
			 
			                   s_flag=0;
			                }
		 
		 
		                 });
						 
					$("#crossBTN").on( "click",function() {
							
						
						$("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
											
                              $("#crossBTN").off();
					});
  
				
				

				
				}else{}
				
				
				});
  
  }

}



</script>

</body>
</html>
